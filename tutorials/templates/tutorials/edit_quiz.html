{% extends 'base.html' %}
{% block title %}Fragen bearbeiten{% endblock %}

{% block content %}
<h2 style="text-align:center;">Fragen für: {{ tutorial.title }}</h2>

<form method="post" id="question-form">
  {% csrf_token %}
  {{ question_formset.management_form }}

  <div id="formset-container">
    {% for qform in question_formset.forms %}
      <div class="card question-card" style="padding:20px; background:#fff; margin:20px auto; max-width:800px; border-radius:12px;">
        <h4>Frage {{ forloop.counter }}</h4>

        {{ qform.id }}
        {{ qform.DELETE }}
        <div style="margin:10px 0; width:90%;">
          {{ qform.text.label_tag }}<br>{{ qform.text }}
        </div>

        <div class="answers" style="margin-top:15px;">
          <!-- 5 statische Antwortfelder pro Frage -->
          <div class="answer-row" style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
            <input type="checkbox" name="answers-{{ forloop.counter0 }}-0-is_correct">
            <input type="text" name="answers-{{ forloop.counter0 }}-0-text" placeholder="Antwort 1" style="flex:1;">
          </div>
          <div class="answer-row" style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
            <input type="checkbox" name="answers-{{ forloop.counter0 }}-1-is_correct">
            <input type="text" name="answers-{{ forloop.counter0 }}-1-text" placeholder="Antwort 2" style="flex:1;">
          </div>
          <div class="answer-row" style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
            <input type="checkbox" name="answers-{{ forloop.counter0 }}-2-is_correct">
            <input type="text" name="answers-{{ forloop.counter0 }}-2-text" placeholder="Antwort 3" style="flex:1;">
          </div>
          <div class="answer-row" style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
            <input type="checkbox" name="answers-{{ forloop.counter0 }}-3-is_correct">
            <input type="text" name="answers-{{ forloop.counter0 }}-3-text" placeholder="Antwort 4" style="flex:1;">
          </div>
          <div class="answer-row" style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
            <input type="checkbox" name="answers-{{ forloop.counter0 }}-4-is_correct">
            <input type="text" name="answers-{{ forloop.counter0 }}-4-text" placeholder="Antwort 5" style="flex:1;">
          </div>
        </div>
        <div style="text-align:center; margin-top:20px;">
          <button type="button" class="delete-question-btn action-button red">– Frage löschen</button>
        </div>
      </div>
    {% endfor %}
  </div>

  <div style="text-align:center; margin-top:30px;">
    <button type="button" id="add-question-btn" class="action-button blue">+ Neue Frage</button>
    <button type="submit" class="action-button blue">Speichern</button>
  </div>
</form>

<style>
.question-card { box-shadow:0 4px 8px rgba(0,0,0,0.1); margin-bottom:20px; }
.answer-row input[type="text"] { flex:1; }
</style>



<script>
// Frage löschen
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('delete-question-btn')) {
    const card = e.target.closest('.question-card');
    card.style.transition = 'transform 0.4s ease, opacity 0.4s ease';
    card.style.transform = 'rotateX(-90deg)';
    card.style.opacity = '0';
    setTimeout(() => {
      const deleteField = card.querySelector('input[name$="-DELETE"]');
      if (deleteField) deleteField.value = 'on';
      card.remove();
      document.querySelectorAll('.question-card h4').forEach((h4, idx) => {
        h4.textContent = `Frage ${idx+1}`;
      });
    }, 400);
  }
});

// Neue Frage hinzufügen
document.getElementById('add-question-btn').addEventListener('click', () => {
  const container = document.getElementById('formset-container');
  const total = document.getElementById('id_questions-TOTAL_FORMS');
  const idx = parseInt(total.value);
  let html = `
    <div class="card question-card" style="padding:20px; background:#fff; margin:20px auto; max-width:800px; border-radius:12px;">
      <h4>Frage</h4>
      <input type="hidden" name="questions-${idx}-id" value="">
      <input type="hidden" name="questions-${idx}-DELETE" value="">
      <div style="margin:10px 0; width:90%;">
        <input type="text" name="questions-${idx}-text" placeholder="Fragetext" style="width:100%;">
      </div>
      <div class="answers" style="margin-top:15px;">
        ${[0,1,2,3,4].map(i =>
          `<div class="answer-row" style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
            <input type="checkbox" name="answers-${idx}-${i}-is_correct">
            <input type="text" name="answers-${idx}-${i}-text" placeholder="Antwort ${i+1}" style="flex:1;">
          </div>`
        ).join('')}
      </div>
      <div style="text-align:center; margin-top:20px;">
        <button type="button" class="delete-question-btn action-button red">– Frage löschen</button>
      </div>
    </div>`;
  const temp = document.createElement('div');
  temp.innerHTML = html;
  container.appendChild(temp.firstElementChild);
  total.value = idx + 1;
});
</script>
{% endblock %}
