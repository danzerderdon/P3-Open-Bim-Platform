{% extends 'base.html' %}
{% block title %}Tutorial erstellen{% endblock %}

{% block content %}
<!-- Quill Editor CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<div class="section-container">
  <h1 style="color: #156082;text-align: center;">Neues Tutorial erstellen</h1>

  <div class="card-container">
    <form method="post" enctype="multipart/form-data" style="max-width: 600px; margin: auto;">
      {% csrf_token %}

      <div style="margin-bottom: 20px;">
        <label><strong>Titel:</strong></label><br>
        {{ form.title }}
      </div>

      <div style="margin-bottom: 20px;">
        <label><strong>Beschreibung:</strong></label><br>
        <!-- Quill Editor -->
        <textarea name="description" id="description-field" hidden>{{ form.description.value|safe }}</textarea>
        <div id="quill-container" style="height: 200px;"></div>
      </div>

      <div style="margin-bottom: 20px;">
        <label><strong>Schwierigkeitsgrad:</strong></label><br>
        {{ form.difficulty }}
      </div>

      <div style="margin-bottom: 20px;">
        <label><strong>Programm:</strong></label><br>
        {{ form.program }}
      </div>

      <div style="margin-bottom: 20px;">
        <label for="{{ form.program_versions.id_for_label }}"><strong>Programmversion(en):</strong></label><br>
        {{ form.program_versions }}<br>
        <small style="color: #555;">z.â€¯B. 2021, 2022, 2023</small>
      </div>

      <div style="margin-bottom: 20px;">
        <label><strong>Keywords:</strong></label><br>
        {{ form.keywords }}
        <small>Kommagetrennt, z.B. IFC, Modellierung, BIM</small>
      </div><br>

      <div style="margin-bottom: 20px;">
        <label><strong>Vorschaubild:</strong></label><br><br>
        {{ form.thumbnail }}<br>
        <div id="thumbnail-preview" style="margin-top: 10px;"></div>
      </div><br>

      <div style="margin-bottom: 20px;">
        <label><strong>Screenshot (Prozessdiagramm):</strong></label><br><br>
        {{ form.screenshot }}
        <div id="screenshot-preview" style="margin-top: 10px;"></div>
      </div><br>

      <div style="margin-bottom: 20px;">
        <label><strong>Dateien anhÃ¤ngen:</strong></label><br>
        <small>z.B. PDFs, Arbeitsmaterial, IFC-Dateien etc.</small><br><br>
        {{ form.attachments }}
        <div id="attachments-list" style="margin-top: 10px;"></div>
      </div><br>

      <div style="margin-bottom: 30px;">
        <label><strong>Tutorial-Serie:</strong></label><br>
        <small>z.B. "Solibri Basics" (optional)</small><br>
        {{ form.series }}
      </div>

      <div style="text-align: center;">
        <button type="submit" class="button">Weiter zu den Schritten</button>
      </div>
    </form>

    {% if form.errors %}
      <div style="color: red; margin-top: 20px;">
        <h3>Fehler im Formular:</h3>
        <ul>
          {% for field in form %}
            {% for error in field.errors %}
              <li><strong>{{ field.label }}:</strong> {{ error }}</li>
            {% endfor %}
          {% endfor %}
          {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>
</div>

<!-- Quill Editor JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // === Quill Editor ===
    const textarea = document.getElementById('description-field');
    const quillContainer = document.getElementById('quill-container');

    const quill = new Quill(quillContainer, {
      theme: 'snow',
      placeholder: 'Beschreibung eingeben...'
    });

    quill.root.innerHTML = textarea.value || '';

    textarea.form.addEventListener('submit', function () {
      textarea.value = quill.root.innerHTML;
    });

    // === Bildvorschau ===
    function previewImage(input, previewId) {
      const preview = document.getElementById(previewId);
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function (e) {
          preview.innerHTML = '<img src="' + e.target.result + '" style="max-width: 100%; border-radius: 8px;">';
        };
        reader.readAsDataURL(input.files[0]);
      } else {
        preview.innerHTML = '';
      }
    }

    const thumbnailInput = document.getElementById('id_thumbnail');
    if (thumbnailInput) {
      thumbnailInput.addEventListener('change', function () {
        previewImage(this, 'thumbnail-preview');
      });
    }

    const screenshotInput = document.getElementById('id_screenshot');
    if (screenshotInput) {
      screenshotInput.addEventListener('change', function () {
        previewImage(this, 'screenshot-preview');
      });
    }

    // === Dateinamen anzeigen ===
    const attachmentsInput = document.getElementById('id_attachments');
    const attachmentsList = document.getElementById('attachments-list');

    if (attachmentsInput && attachmentsList) {
      attachmentsInput.addEventListener('change', function () {
        attachmentsList.innerHTML = '';
        Array.from(this.files).forEach(file => {
          const item = document.createElement('div');
          item.textContent = 'ðŸ“„ ' + file.name;
          attachmentsList.appendChild(item);
        });
      });
    }
  });
</script>

<style>
  .ql-editor {
    min-height: 150px;
    margin: 0 0 5px;
  }
</style>
{% endblock %}
